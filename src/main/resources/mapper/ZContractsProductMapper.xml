<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.haier.hailian.contract.dao.ZContractsProductDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.haier.hailian.contract.entity.ZContractsProduct">
        <id column="id" property="id" />
        <result column="contract_id" property="contractId" />
        <result column="product_series" property="productSeries" />
        <result column="qty_year" property="qtyYear" />
        <result column="qty_month" property="qtyMonth" />
        <result column="target_name" property="targetName" />
        <result column="target_code" property="targetCode" />
        <result column="target_unit" property="targetUnit" />
        <result column="scene_name" property="sceneName" />
    </resultMap>

    <!-- 合约的爆款数据 -->
    <select id="calContractProduct" parameterType="com.haier.hailian.contract.entity.ZContractsProduct"
    resultMap="BaseResultMap"
    >
        select cp.product_series as 'product_series', sum(ifnull(mcgo.order_num,0)) as 'qty_year'
        ,sum(ifnull(mcgo.order_amt,0)) as 'qty_month' from z_contracts_product cp
        join z_product_chain zpc on cp.product_series=zpc.product_series
        left join month_chain_group_order mcgo on zpc.model_code=mcgo.product_code
        where cp.contract_id=#{contractId}
        <if test="qtyMonth!=null and qtyMonth != '' ">
            and mcgo.month=#{qtyMonth}
        </if>
        <if test="qtyYear!=null and qtyYear != '' ">
            and mcgo.year=#{qtyYear}
        </if>
        group by cp.product_series
    </select>


</mapper>
