<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.haier.hailian.contract.dao.MonthChainGroupOrderDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.haier.hailian.contract.entity.MonthChainGroupOrder">
        <id column="id" property="id" />
        <result column="year" property="year" />
        <result column="month" property="month" />
        <result column="product_line_code" property="productLineCode" />
        <result column="product_line_name" property="productLineName" />
        <result column="brand_cdde" property="brandCdde" />
        <result column="brand_name" property="brandName" />
        <result column="xw_code" property="xwCode" />
        <result column="xw_name" property="xwName" />
        <result column="series_code" property="seriesCode" />
        <result column="series_name" property="seriesName" />
        <result column="product_code" property="productCode" />
        <result column="product_name" property="productName" />
        <result column="trade_code" property="tradeCode" />
        <result column="trade_name" property="tradeName" />
        <result column="wg_code" property="wgCode" />
        <result column="wg_name" property="wgName" />
        <result column="order_num" property="orderNum" />
        <result column="order_amt" property="orderAmt" />
        <result column="submit_emp" property="submitEmp" />
        <result column="submit_time" property="submitTime" />
        <result column="add1" property="add1" />
        <result column="add2" property="add2" />
        <result column="add3" property="add3" />
        <result column="add4" property="add4" />
        <result column="add5" property="add5" />
        <result column="add6" property="add6" />
        <result column="add7" property="add7" />
        <result column="add8" property="add8" />
        <result column="add9" property="add9" />
        <result column="add10" property="add10" />
        <result column="is_gzd" property="isGzd" />

    </resultMap>

    <resultMap id="wgGrabIncomeMapper" type="com.haier.hailian.contract.entity.MeshGrabEntity">
        <result column="wg_code" property="meshCode" />
        <result column="wg_name" property="meshName" />
        <result column="income" property="income" />
        <result column="product_code" property="productCode" />
        <result column="product_stru" property="productStru" />
    </resultMap>

    <select id="getProductByContract" resultType="java.lang.String">
        select DISTINCT product_model_code from
        z_gambling_contracts_product_modle gpm
        join z_product_info zpi on gpm.product_model_code=zpi.product_model_code
        where gpm.contracts_id=#{contractId}
        and zpi.period_code in
        <foreach collection="yearMonth" item="item" index="index" open="(" close=")"  separator="," >
            #{item}
        </foreach>
        and zpi.product_stru=#{productStru}
    </select>

    <!--查询网格E2E收入-->
    <select id="queryMeshE2EIncome" parameterType="com.haier.hailian.contract.dto.grab.TyMasterGrabQueryDto"
            resultMap="wgGrabIncomeMapper" >
        select wg_code, wg_name, sum(income) as 'income'from(
        select  mr.first_region_code as 'wg_code',mr.first_region_name as 'wg_name',mr.sales_amount as income
        FROM month_retail mr
        join (select xw_code from sys_xw_master where master_code=#{contractOwner}) xwm
        on mr.smb_code=xwm.xw_code
        join (select DISTINCT jyt_code from sys_net where xw_code=#{loginXwCode}) sn
        on mr.first_region_code=sn.jyt_code
        where mr.schedule_year=#{year} and mr.schedule_month IN
        <foreach collection="month" item="item" index="index" open="(" close=")"  separator="," >
            #{item}
        </foreach>
        ) base
        GROUP BY wg_code,wg_name
    </select>

    <!--查询网格抢单收入-->
    <select id="queryMeshGrabIncome" parameterType="com.haier.hailian.contract.dto.grab.TyMasterGrabQueryDto"
            resultMap="wgGrabIncomeMapper" >
        select wg_code, wg_name, is_gzd as 'product_stru', sum(order_amt) as 'income'
        FROM month_chain_group_order
        where chain_code=#{chainCode} and trade_code=#{regionCode} and year=#{year} and month IN
        <foreach collection="month" item="item" index="index" open="(" close=")"  separator="," >
            #{item}
        </foreach>
        GROUP BY wg_code,wg_name,is_gzd
    </select>

    <!--查询网格抢单收入按型号汇总-->
    <select id="sumStruMeshGrabIncome" parameterType="com.haier.hailian.contract.dto.grab.TyMasterGrabQueryDto"
            resultMap="wgGrabIncomeMapper" >
        select is_gzd as 'product_stru', sum(order_amt) as 'income'
        FROM month_chain_group_order
        where chain_code=#{chainCode} and trade_code=#{regionCode} and year=#{year} and month IN
        <foreach collection="month" item="item" index="index" open="(" close=")"  separator="," >
            #{item}
        </foreach>
        GROUP BY is_gzd
    </select>



</mapper>
